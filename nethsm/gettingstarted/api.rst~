Instructions 
============

NetHSM container requires nested virtualization for strong separation with other containers. Thus, to start a NetHSM container you need a Linux host with /dev/kvm available. Execute this command:

.. code:: bash

 $ sudo docker run --rm -ti --device=/dev/kvm:/dev/kvm --device=/dev/net/tun:/dev/net/t un --cap-add=NET_ADMIN -p8443:8443 nitrokey/nethsm:testing

**API Tutorial**
^^^^^^^^^^^^^^^^

First, let's see what we have here:

.. code:: bash

 $ curl -k -i -w '\n' https://localhost:8443/api/v1/info

::

	HTTP/1.1 200 OK
	content-length: 45
	content-type: application/json
	date: Mon, 25 Jan 2021 21:00:27 GMT
	etag: "7bab62510e05c332735624bc7a585a30"
	vary: Accept, Accept-Encoding, Accept-Charset, Accept-Language

	{"vendor":"Nitrokey GmbH","product":"NetHSM"}

**See what the device's status is:**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. code:: bash

 $ curl -k -i -w '\n' https://localhost:8443/api/v1/health/state

::

	HTTP/1.1 200 OK
	cache-control: no-cache
	content-length: 25
	content-type: application/json
	date: Mon, 25 Jan 2021 20:57:32 GMT
	vary: Accept, Accept-Encoding, Accept-Charset, Accept-Language

	{"state":"Unprovisioned"}

**Provision**
^^^^^^^^^^^^^


.. code:: bash

 $ curl -k -i -w '\n' -X POST https://localhost:8443/api/v1/provision -H "content-type: application/json" -d "{ adminPassphrase: \"adminPassphrase\", unlockPassphrase: \"unlockPassphrase\", systemTime: \"$(date --utc -Iseconds)\"}"

::

	HTTP/1.1 204 No Content
	cache-control: no-cache
	content-type: application/json
	date: Wed, 11 Nov 2020 16:35:44 GMT
	vary: Accept, Accept-Encoding, Accept-Charset, Accept-Language

**Create Keys**
^^^^^^^^^^^^^^^

.. code:: bash

 $ curl -k -i -w '\n' -u admin:adminPassphrase -X POST https://localhost:8443/api/v1/ke ys/generate -H "content-type: application/json" -d "{ \"mechanisms\": [  \"RSA_Signatu re_PSS_SHA256\"  ],  \"algorithm\": \"RSA\",  \"length\": 2048,  \"id\": \"myFirstKey\"}"

::

	HTTP/1.1 201 Created
	cache-control: no-cache
	content-length: 0
	content-type: application/json
	date: Tue, 26 Jan 2021 05:54:09 GMT
	location: /api/v1/keys/0ead0d9dd849cecf845c
	vary: Accept, Accept-Encoding, Accept-Charset, Accept-Language

**List Keys**
^^^^^^^^^^^^^

.. code:: bash

 $ curl -k -i -w '\n' -u admin:adminPassphrase https://localhost:8443/api/v1/keys

.. code:: bash

	HTTP/1.1 200 OK
	content-length: 39
	content-type: application/json
	date: Tue, 26 Jan 2021 05:56:24 GMT
	etag: "34353234366432333063663739313939346635316666343937333564653434333937613237626139"
	vary: Accept, Accept-Encoding, Accept-Charset, Accept-Language

	[{"key":"myFirstKey"}]


**Show Key Details**
^^^^^^^^^^^^^^^^^^^^

.. code:: bash

 $ curl -s -k -w '\n' -u admin:adminPassphrase https://localhost:8443/api/v1/keys/myFirstKey

::

		{"mechanisms":["RSA_Signature_PSS_SHA256"],"algorithm":"RSA","modulus":"td583uBYRfO7qtvPoQF7liUh8gq3zckCk9LpCfblx2S0HdOvButfD4TyH4EMiZj3NhEoq18BZhqhxTL22UyNJwYJd2tCF4EbgTaj/Z3LeCPoGN5LjadFCsYriPeHsdnuLmTK6KsmTAP/CWJ+u3LesU5bCGWbDnPjv2WaLTeiMuNw1347gj1drft8jFA9SmOFjZxM9pq2Hk1nQSYpeAPCnigC7hLwAWgzKqVQv/J7VVWat3ke/jOrxFiRDFIeC3qxtBs6T7GYwqmsxkxgqKDljTAH4qMrC9vgVbbFPffe8UgmtDfvQ0ghP57b3HYZDON90MJ2qrU944E74g+ua6unTw==","publicExponent":"AQAB","operations":0}

You can find more information on how to work with the API in the NetHSM API Index <https://nethsmdemo.nitrokey.com/api_docs/index.html#docs/summary/summary>

